---
title: "O uso de disco está excepcionalmente alto ou aumentando rapidamente no AEM Server"
description: Descrição
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager 6.4,Experience Manager 6.5"
keywords: "KCS, AEM, desempenho, disco cheio"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "5/2/2023 8:37:19 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "5/2/2023 9:42:51 PM"
version-number: 4
article-number: KA-17496
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=104d8e1f-29e9-ed11-a7c6-6045bd006268"
source-git-commit: 6c7ffa0f531ed55ab0f12cd236b44e9b992e6a89
workflow-type: tm+mt
source-wordcount: '572'
ht-degree: 6%

---

# O uso do disco está aumentando de forma anormal ou rápida no servidor AEM

## Descrição {#description}


<b>Ambiente</b>

Adobe Experience Manager

<b>Problema/Sintomas</b>

O uso de disco está excepcionalmente alto ou aumentando rapidamente em um servidor AEM. Com o espaço em disco esgotado, AEM parou de funcionar.




## Resolução {#resolution}

<b>A. Se AEM estiver em execução e houver espaço em disco amplo</b>
1. <b>Configurar o registro de rastreamento de gravação do oak</b>    Se AEM ainda estiver em execução, poderemos ativar um agente de depuração para nos informar quais caminhos do repositório estão sendo gravados. Para ativar esse logger, instale o pacote de configuração de log anexado abaixo ou siga estas etapas:

   1. Ir para *https://aemhost:port/system/console/slinglog*
   2. Clique em <b>Adicionar novo logger</b>.
   3. Configure um logger: <b>Arquivo de log:</b> logs/repgrowth.log, <b>Nível de log</b>: traço, <b>Loggers:</b> org.apache.jackrabbit.oak.jcr.operations.writes
   4. Baixar [arquivo](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/analyze-unusual-repository-growth/jcr:content/main-pars/download/log_repository_growth-1.zip).        Este pacote contém a configuração necessária para a sessão de gravação de log do Oak. Instale este pacote por meio do Gerenciador de pacotes do CRX. Após o período do monitor, desinstale o pacote.

   <b>Cuidado</b>

   - O log inclui informações sobre todas as gravações e detalhes da sessão. Se você usar esse registrador, verifique se há espaço em disco suficiente.
   - Desinstale o pacote de configuração de log ou remova a configuração de log após um curto período de habilitação para evitar mais consumo de espaço em disco.
2. <b>Executar o relatório de uso do disco</b>    Você também pode aproveitar o relatório de Uso de disco https://host:port/etc/reports/diskusage.html. Este relatório exibe o espaço em disco usado pelo caminho do repositório. O relatório é pesquisável, permitindo que você visualize subárvores também.
3. <b>Capturar despejos de encadeamento e executar criação de perfis</b>    Depois de usar o repgrowth.log para obter uma ideia de quais dados estão sendo gravados, podemos obter informações sobre qual código está gravando esses dados, capturando despejos de encadeamentos e executando a criação de perfis da CPU. Visite estas páginas:

   - [Criação de perfis da CPU](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17499.html?lang=pt-BR)
   - [Capturando despejos de encadeamento](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17452.html?lang=pt-BR)
   - [Analisando AEM despejos de thread](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-16458.html?lang=pt-BR)

<b>B. Se AEM parou e/ou o espaço em disco está quase cheio</b>
Se tiver que parar AEM para evitar o aumento do espaço em disco, use os comandos abaixo para fazer uma análise inicial.

- Na plataforma Linux, aproveite o <b>du</b> comando para listar todos os diretórios em <b>crx-quickstart</b> com o tamanho resumido desses diretórios:<br>

   ```
   du -h --max-depth=2 crx-quickstart
   ```

- Use <b>find</b> e <b>du</b> comandos para localizar arquivos modificados recentemente e obter seus tamanhos:

   ```
   find crx-quickstart -type f -mtime 1 -exec du -hs {} \; -print
   ```

- Para localizar arquivos grandes no armazenamento de dados, você pode combinar <b>find</b>, <b>du</b>e <b>arquivo</b> comandos para localizar arquivos acima de 100MB no <b>armazenamento de dados</b> diretório e identificar automaticamente seu tipo de arquivo:

   ```
   find crx-quickstart/repository/datastore -type f -size +100M -exec sh -c "du -hs \"{}\"; file \"{}\"" \;
   ```

- Se achar que o crescimento está ocorrendo na <b>segmentstore</b> , o comando abaixo pode ajudar a indicar quais dados estão sendo gravados:

   ```
   strings data_xxxxxx.tar | egrep '.?/' | sed 's/.$//;s/.\//\//'
   ```

<b>Causa</b>
Algumas possíveis causas de aumentos incomuns na utilização do disco são:

- A manutenção adequada não foi executada no sistema.  Consulte este artigo para obter detalhes sobre várias atividades de manutenção do sistema.
- AEM ou o aplicativo está criando um número muito grande de nós ou atualizações nas propriedades do nó.  Isso pode ser devido a uma configuração incorreta ou a um bug no código do aplicativo.  Como o armazenamento tar no Oak opera em um modo somente de acréscimo, o salvamento repetido de nós contribui ainda mais para o crescimento excessivo do repositório.
- Arquivos muito grandes foram carregados no AEM Assets ou no gerenciador de pacotes.
- O log de depuração ou rastreamento foi deixado ativado.

