---
title: Arquivos somente leitura
description: Descrição
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:23:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 2:18:00 PM
version-number: 1
article-number: KA-17483
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=88d504a5-9332-ec11-b6e5-000d3a5ba97a
exl-id: ccc49009-5cc4-48d5-84a3-3f7283afb1ca
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '807'
ht-degree: 0%

---

# Arquivos somente leitura

## Descrição

O documento descreverá quais arquivos estão bloqueados no e como fazer as configurações desejadas corretamente.<br><br> <br><br><br><br><br>Por quê?<br><br><br><br> <br><br>
Quando o AMS fornece um sistema, ele implementa uma configuração de linha de base que torna tudo funcional e seguro.  Essas não são coisas que o AMS deseja garantir que permaneçam como uma linha de base de funcionalidade e segurança.  Para conseguir isso, alguns arquivos são marcados como somente leitura e imutáveis para evitar que você os altere.

O layout não impede que você altere seu comportamento e substitua as alterações necessárias.  Em vez de alterar esses arquivos, você sobreporá seu próprio arquivo que substitui o original.

Isso também permite que você tenha certeza de que, quando o AMS aplicar patches, os dispatchers com as últimas correções e aprimoramentos de segurança, eles não alterarão seus arquivos.  Em seguida, você pode continuar a se beneficiar das melhorias e adotar apenas as alterações desejadas.
![Mostra uma faixa de boliche com uma bola rolando pela pista.  A bola tem uma seta com a palavra &quot;você&quot;.  Os para-choques da sarjeta são levantados e eles têm as palavras &quot;arquivos imutáveis&quot; acima deles.](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/bowling-file-immutability.png "boliche-ficheiro-immutabilidade")<br><br><br><br> <br><br>
Como ilustrado na figura acima, arquivos imutáveis não impedem que você jogue o jogo.  Eles só te impedem de prejudicar sua performance e te manter na pista.  Este método permite usar os poucos recursos mais importantes:

- As personalizações são manipuladas em seus próprios espaços de segurança
- A sobreposição de alterações personalizadas espelha a dos métodos de sobreposição no AEM
- A correção de configurações do AMS pode ser feita sem alterar as personalizações
- A instalação da base de teste versus configurações personalizadas pode ser feita simultaneamente para ajudar a discernir se os problemas são causados por personalizações ou algo mais

<br><br><br><br>Quais arquivos?<br><br><br><br> <br><br>
Esta é uma lista típica de arquivos implantados com um dispatcher:
<br><br><br><br><br> <br><br><br><br>


`| /etc/httpd/ ├── conf │   └── httpd.conf ├── conf.d │   ├── available_vhosts │   │   ├── 000_unhealthy_author.vhost │   │   ├── 000_unhealthy_publish.vhost │   │   ├── aem_author.vhost │   │   ├── aem_flush.vhost │   │   ├── aem_health.vhost │   │   ├── aem_lc.vhost │   │   └── aem_publish.vhost │   ├── dispatcher_vhost.conf │   ├── enabled_vhosts │   │   ├── aem_author.vhost - /etc/httpd/conf .d /available_vhosts/aem_author .vhost │   │   ├── aem_flush.vhost - /etc/httpd/conf .d /available_vhosts/aem_flush .vhost │   │   ├── aem_health.vhost - /etc/httpd/conf .d /available_vhosts/aem_health .vhost │   │   └── aem_publish.vhost - /etc/httpd/conf .d /available_vhosts/aem_publish .vhost │   ├── logformat.conf │   ├── remoteip.conf │   ├── rewrites │   │   ├── base_rewrite.rules │   │   └── xforwarded_forcessl_rewrite.rules │   ├── security.conf │   ├── variables │   │   └── ams_default.vars │   └── whitelists │       └── 000_base_whitelist.rules ├── conf.dispatcher.d │   ├── available_farms │   │   ├── 000_ams_author_farm.any │   │   ├── 001_ams_lc_farm.any │   │   └── 999_ams_publish_farm.any │   ├── cache │   │   ├── ams_author_cache.any │   │   ├── ams_author_invalidate_allowed.any │   │   ├── ams_publish_cache.any │   │   └── ams_publish_invalidate_allowed.any │   ├── clientheaders │   │   ├── ams_author_clientheaders.any │   │   ├── ams_common_clientheaders.any │   │   ├── ams_lc_clientheaders.any │   │   └── ams_publish_clientheaders.any │   ├── dispatcher.any │   ├── enabled_farms │   │   ├── 000_ams_author_farm.any - /etc/httpd/conf .dispatcher.d /available_farms/000_ams_author_farm .any │   │   └── 999_ams_publish_farm.any - /etc/httpd/conf .dispatcher.d /available_farms/999_ams_publish_farm .any │   ├── filters │   │   ├── ams_author_filters.any │   │   ├── ams_lc_filters.any │   │   └── ams_publish_filters.any │   ├── renders │   │   ├── ams_author_renders.any │   │   ├── ams_lc_renders.any │   │   └── ams_publish_renders.any │   └── vhosts │       ├── ams_author_vhosts.any │       ├── ams_lc_vhosts.any │       └── ams_publish_vhosts.any ├── conf.modules.d │   ├── 01-cgi.conf │   └── 02-dispatcher.conf └── modules - ../.. /usr/lib64/httpd/modules     └── mod_dispatcher.so |`

Para determinar quais arquivos são imutáveis, você pode executar o seguinte comando em um dispatcher para ver:
<br><br><br><br><br> <br><br><br><br>

`$ lsattr -Rl` `/etc/httpd` `2` `/dev/null` `|` `grep` `Immutable`

<br><br><br><br><br> <br><br>
Esta é uma amostra de resposta de quais arquivos são imutáveis:
<br><br><br><br><br> <br><br><br><br>

`/etc/httpd/conf/httpd .conf   Immutable /etc/httpd/conf .d /available_vhosts/aem_author .vhost Immutable /etc/httpd/conf .d /available_vhosts/aem_publish .vhost Immutable /etc/httpd/conf .d /available_vhosts/aem_lc .vhost Immutable /etc/httpd/conf .d /available_vhosts/aem_flush .vhost Immutable /etc/httpd/conf .d /available_vhosts/aem_health .vhost Immutable /etc/httpd/conf .d /available_vhosts/000_unhealthy_author .vhost Immutable /etc/httpd/conf .d /available_vhosts/000_unhealthy_publish .vhost Immutable /etc/httpd/conf .d /rewrites/base_rewrite .rules Immutable /etc/httpd/conf .d /rewrites/xforwarded_forcessl_rewrite .rules Immutable /etc/httpd/conf .d /whitelists/000_base_whitelist .rules Immutable /etc/httpd/conf .d /dispatcher_vhost .conf Immutable /etc/httpd/conf .d /logformat .conf Immutable /etc/httpd/conf .d /security .conf Immutable /etc/httpd/conf .modules.d /02-dispatcher .conf Immutable /etc/httpd/conf .dispatcher.d /available_farms/000_ams_author_farm .any Immutable /etc/httpd/conf .dispatcher.d /available_farms/999_ams_publish_farm .any Immutable /etc/httpd/conf .dispatcher.d /available_farms/001_ams_lc_farm .any Immutable /etc/httpd/conf .dispatcher.d /cache/ams_author_cache .any Immutable /etc/httpd/conf .dispatcher.d /cache/ams_author_invalidate_allowed .any Immutable /etc/httpd/conf .dispatcher.d /cache/ams_publish_cache .any Immutable /etc/httpd/conf .dispatcher.d /cache/ams_publish_invalidate_allowed .any Immutable /etc/httpd/conf .dispatcher.d /clientheaders/ams_author_clientheaders .any Immutable /etc/httpd/conf .dispatcher.d /clientheaders/ams_publish_clientheaders .any Immutable /etc/httpd/conf .dispatcher.d /clientheaders/ams_common_clientheaders .any Immutable /etc/httpd/conf .dispatcher.d /clientheaders/ams_lc_clientheaders .any Immutable /etc/httpd/conf .dispatcher.d /filters/ams_author_filters .any Immutable /etc/httpd/conf .dispatcher.d /filters/ams_publish_filters .any Immutable /etc/httpd/conf .dispatcher.d /filters/ams_lc_filters .any Immutable /etc/httpd/conf .dispatcher.d /renders/ams_author_renders .any Immutable /etc/httpd/conf .dispatcher.d /renders/ams_publish_renders .any Immutable /etc/httpd/conf .dispatcher.d /renders/ams_lc_renders .any Immutable /etc/httpd/conf .dispatcher.d /vhosts/ams_author_vhosts .any Immutable /etc/httpd/conf .dispatcher.d /vhosts/ams_publish_vhosts .any Immutable /etc/httpd/conf .dispatcher.d /vhosts/ams_lc_vhosts .any Immutable /etc/httpd/conf .dispatcher.d /dispatcher .any Immutable`



## Resolução

<br><br>Como fazer alterações<br><br><br><br> <br><br>Variáveis<br><br><br><br> <br><br>
As variáveis permitem fazer alterações funcionais sem alterar os próprios arquivos de configurações.  Determinados elementos da configuração podem ser ajustados com o ajuste dos valores das variáveis.  Um exemplo que podemos destacar do arquivo *`/etc/httpd/conf.d/dispatcher_vhost.conf`* é mostrado aqui:
<br><br><br><br><br> <br><br><br><br>

`Include /etc/httpd/conf.d/variables/ams_default.vars IfModule disp_apache2.c    DispatcherConfig conf.dispatcher.d/dispatcher.any    DispatcherLog    logs/dispatcher.log    DispatcherLogLevel ${DISP_LOG_LEVEL}    DispatcherDeclineRoot 0    DispatcherUseProcessedURL 1/IfModule`

<br><br><br><br><br> <br><br>
Veja como a função <b>`DispatcherLogLevel`</b> a diretiva tem uma variável de `DISP_LOG_LEVEL` em vez do valor normal, você veria lá.  Acima dessa seção do código, você também verá uma instrução include em um arquivo de variáveis.  O arquivo de variável *`/etc/httpd/conf.d/variables/ams_default.vars`*é onde queremos olhar a seguir.  Este é o conteúdo desse arquivo de variáveis:
<br><br><br><br><br> <br><br><br><br>

`Define DISP_LOG_LEVEL info Define AUTHOR_WHITELIST_ENABLED 0 Define PUBLISH_WHITELIST_ENABLED 0 Define LIVECYCLE_WHITELIST_ENABLED 0 Define AUTHOR_FORCE_SSL 1 Define PUBLISH_FORCE_SSL 0 Define LIVECYCLE_FORCE_SSL 1 `

<br><br><br><br><br> <br><br>
Se você vir o valor atual de `DISP_LOG_LEVEL` é informação.  Podemos ajustar para rastrear ou depurar, ou o valor/nível do número de sua escolha.  Agora, em todos os locais que controlam o nível do log, ele se ajustará automaticamente.
<br><br><br><br> <br><br>Método de sobreposição<br><br><br><br> <br><br>
Entenda a [arquivos de inclusão de nível superior](https://helpx.adobe.com/experience-manager/kb/ams-dispatcher-manual/explanation-config-files.html#include-order) porque esse será o local inicial para fazer personalizações.  Para começar com um exemplo simples, temos um cenário em que queremos adicionar um novo nome de domínio que pretendemos apontar para este dispatcher.  O exemplo de domínio que usaremos é <b>`we-retail.adobe.com`. </b> Começaremos copiando um arquivo de configuração existente em um novo, onde podemos adicionar as alterações:
<br><br><br><br><br> <br><br><br><br>

`$ cp /etc/httpd/conf .d /available_vhosts/aem_publish .vhost /etc/httpd/conf .d /available_vhosts/weretail_publish .vhost`

<br><br><br><br><br> <br><br>
Copiamos as *`aem_publish.vhost`* porque já tem o que precisamos para fazer as coisas funcionarem e não queremos reinventar um começo já forte.  Agora editamos o novo *`weretail.vhost`* e faça as alterações necessárias.

Antes:
<br><br><br><br><br> <br><br><br><br>

`VirtualHost *:80      ServerName    publish      ServerAlias    ${PUBLISH_DEFAULT_HOSTNAME}      DocumentRoot    ${PUBLISH_DOCROOT}      IfModule mod_headers.c              Header always add X-Dispatcher ${DISP_ID}              Header always add X-Vhost "publish"              Header merge X-Frame-Options SAMEORIGIN "expr=%{resp:X-Frame-Options}!='SAMEORIGIN'"              Header merge X-Content-Type-Options nosniff "expr=%{resp:X-Content-Type-Options}!='nosniff'"          Header append Vary User-Agent env=!dont-vary      /IfModule ....... SNIP....... /VirtualHost`

<br><br><br><br><br> <br><br>
Depois:
<br><br><br><br><br> <br><br><br><br>

`VirtualHost *:80      ServerName    weretail-publish      ServerAlias    we-retail.adobe.com      DocumentRoot    ${PUBLISH_DOCROOT}      IfModule mod_headers.c              Header always add X-Dispatcher ${DISP_ID}              Header always add X-Vhost "werteail-publish"              Header merge X-Frame-Options SAMEORIGIN "expr=%{resp:X-Frame-Options}!='SAMEORIGIN'"              Header merge X-Content-Type-Options nosniff "expr=%{resp:X-Content-Type-Options}!='nosniff'"          Header append Vary User-Agent env=!dont-vary      /IfModule ....... SNIP....... /VirtualHost`

<br><br><br><br><br> <br><br>
Agora, atualizamos nossa `ServerName` e `ServerAlias` para corresponder aos novos nomes de domínio, bem como atualizar outros cabeçalhos de navegação estrutural.  Agora vamos permitir que nosso novo arquivo permita que o apache saiba usar nosso novo arquivo:
<br><br><br><br><br> <br><br><br><br>

`$ cd /etc/httpd/conf .d /enabled_vhosts/ ; ln -s .. /available_vhosts/weretail_publish .vhost`

<br><br><br><br><br> <br><br>
Agora, o servidor Web apache sabe que o domínio é algo que deve fornecer tráfego, mas ainda precisamos informar ao módulo Dispatcher que ele tem um novo nome de domínio para honrar.  Começaremos criando um novo \*`_vhost.any` arquivo <b>`/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any`</b> e dentro desse arquivo, colocaremos o nome de domínio que queremos honrar:
<br><br><br><br><br> <br><br><br><br>

`we-retail.adobe.com`

<br><br><br><br><br> <br><br>
Agora precisamos criar um novo arquivo farm que usará o nosso novo `vhost` arquivo de entrada e começaremos copiando um arquivo de início forte para nosso novo arquivo.
<br><br><br><br><br> <br><br><br><br>

`$ cp /etc/httpd/conf .dispatcher.d /available_farms/999_ams_publish_farm .any /etc/httpd/conf .dispatcher.d /available_farms/400_weretail_publish_farm .any`

<br><br><br><br><br> <br><br>
Vamos mostrar as alterações que precisaremos fazer neste arquivo farm

Antes:
<br><br><br><br><br> <br><br><br><br>

`/publishfarm {       /virtualhosts {          $include "/etc/httpd/conf.dispatcher.d/vhosts/ams_publish_vhosts.any"      } ........SNIP......... }`

<br><br><br><br><br> <br><br>
Depois:
<br><br><br><br><br> <br><br><br><br>

`/weretailpublishfarm {       /virtualhosts {          $include "/etc/httpd/conf.dispatcher.d/vhosts/weretail_publish_vhosts.any"      } ........SNIP......... }`

<br><br><br><br><br> <br><br>
Agora atualizamos o nome do farm e a inclusão que ele usa no `/virtualhosts` da configuração do farm.  Precisamos ativar este novo arquivo farm para que ele possa usá-lo na configuração em execução:
<br><br><br><br><br> <br><br><br><br>

`$ cd /etc/httpd/conf .dispatcher.d /enabled_farms/ ; ln -s .. /available_farms/400_weretail_publish_farm .any`


Agora, basta recarregar o serviço do servidor da Web e usar nosso novo domínio!

Observação:

Observe que alteramos apenas as partes necessárias para alterar e aproveitar as inclusões e o código existentes que vieram com os arquivos de configuração da linha de base.  Temos apenas de definir o elemento que precisamos de mudar.  Torna as coisas muito mais fáceis e nos permite manter menos código
