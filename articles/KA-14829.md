---
title: Campaign Classic V7 - O que é o módulo db pg_stat_statement? Para que serve?
description: Descrição
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: https://wiki.corp.adobe.com/pages/viewpage.action?spaceKey=neolane&title=Database+performance+optimization+-+Identify+bottleneck+queries+with+execution+statistics#Databaseperformanceoptimization-Identifybottleneckquerieswithexecutionstatistics-pg_stat_statements
bug: false
article-created-by: Marta Zator
article-created-date: 5/4/2022 4:36:53 PM
article-published-by: Marta Zator
article-published-date: 5/4/2022 4:38:25 PM
version-number: 2
article-number: KA-14829
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=aa74c765-c8cb-ec11-a7b5-6045bd00d4f5
exl-id: ad0f34e4-bf33-4eef-a290-7b0a3e92a6c9
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '350'
ht-degree: 1%

---

# Campaign Classic V7 - O que é o módulo db pg_stat_statement? Para que serve?

## Descrição


1. O que é o módulo do db pg_stat_statement ?

2. Por que é solicitado a habilitar por clientes?

3. Como é ativado?






## Resolução




1.  O módulo pg_stat_statement fornece um meio para rastrear as estatísticas de execução de todas as instruções SQL executadas por um servidor.

O módulo deve ser carregado adicionando pg_stat_statement_library a shared_preload_library em postgresql.conf, porque requer memória compartilhada adicional. Isso significa que é necessário reiniciar o servidor para adicionar ou remover o módulo.

Link : [https://www.postgresql.org/docs/9.4/pgstatstatements.html](https://www.postgresql.org/docs/9.4/pgstatstatements.html)



2. Para implementar um schema do tipo view nesta tabela, que permite monitorar consultas que levam muito tempo. Dessa forma, os clientes poderão ajustá-los e otimizar o desempenho.

Essa extensão fornece métricas para executar consultas : que são as consultas executadas com mais frequência e o tempo que cada uma leva.



3.  <b>pg_stat_statement </b>

1. Verifique se o pacote oficial de controladora PostgreSQL para a versão de pôsteres está instalado.

$ dpkg -l | grep postgres postgresql-contrib-9.3

Se não estiver instalado, instale-o.

$ apt-get install postgresql-contrib-9.3

2. Altere postgresql.conf para pré-carregar o módulo na inicialização

Padrão : shared_preload_library = &#39;&#39; Novo : shared_preload_library = &#39;pg_stat_statement&#39; — se estiver usando pg_stat_melhor_statement e auto_Explanation, use um registro ONE e separe-o com vírgulas shared_preload_library = &#39;auto_explicit,pg_stat_statement&#39;

3. No banco de dados que deseja monitorar, execute CREATE query :

— nenhuma criação de extensão necessária para auto_explicit, somente para pg_stat_statement psql postgres=# \c mydatabase mydatabase=# CREATE EXTENSION pg_stat_statement;

4. Na seção CUSTOMIZED OPTIONS de postgresql.conf, adicione as linhas:

pg_stat_statement.max = 5000 pg_stat_statement.track = all pg_stat_statement.save = on

5. Reiniciar o serviço postgresql Exemplo : Obtenha as 5 principais consultas mais caras nos bancos de dados

SELECT query, chamadas, total_time, linhas, 100.0\*shared_blks_hit/nullif(shared_blks_read,0) AS hit_percent de pg_stat_statement como s inner join pg_database as d.oid = s.dbid em que d.datname = &#39;Database_Name&#39; ordem por total_time desc limit 5;
